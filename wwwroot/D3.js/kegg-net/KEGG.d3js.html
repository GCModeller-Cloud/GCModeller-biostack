<!-- 基于D3.js的KEGG数据库可视化查询工具 -->
<html>
<head>
	<title>D3.js KEGG database visualization</title>
	<script src="./d3.v3.min.js"></script>
	<script src="./App.js"></script>
	<style>

        .node {
            stroke: #fff;
            stroke-width: 3.5px;
        }
        .link {
            stroke: #CCC;
            stroke-opacity: 1;
        }
</style>
</head>
<body>
	
	<script>

function d3Network(jsonFile, width, height) {
	    
    var force = d3.layout.force()
        .charge(-100)
        .linkDistance(15)
        .size([width, height]);

    var svg = d3.select("body").append("svg")
		.attr("fill", "#DBF3FF")
        .attr("width", width)
        .attr("height", height)
		.attr("class", "chart");
    
	// 从服务器加载网络的json文件
    d3.json(jsonFile, function (error, graph) {
        if (error) throw error;
		
		console.log(graph);
		
        force
            .nodes(graph.nodes)
            .links(graph.links)
            .start();

		var color = d3.scale.category20();
		// 配置网络之中的边
        var link = svg.selectAll(".link")
            .data(graph.links)
            .enter().append("line")
            .attr("class", "link")
            .style("stroke-width", function(l) {
				return 1;
			});

		// 配置网络之中的节点
		// Create the groups under svg
var nodes = svg.selectAll('g.gnode')
  .data(graph.nodes)
  .enter()
  .append('g')
  .classed('node', true);

// Add one circle in each group
var node = nodes.append("circle")
  .attr("class", "node")
  .attr("r", function (d) {
                return Math.sqrt(d.size*0.8)+5;
            })
            .style("fill", function (d) {
                return color(d.group);
            })
            .style("opacity", 0.95)
            .call(force.drag);
			
var texts = svg.selectAll("text.label")
                .data(graph.nodes)
                .enter().append("text")
                .attr("class", "label")
                .attr("fill", function(d) {
					return color(d.group);
				})
                .text(function(d) {  return d.name;  });
			        
		// 实时更新网络的动态
        force.on("tick", function () {
            link.attr("x1", function (d) { return d.source.x; })
                .attr("y1", function (d) { return d.source.y; })
                .attr("x2", function (d) { return d.target.x; })
                .attr("y2", function (d) { return d.target.y; });

            node.attr("cx", function (d) { return d.x; })
                .attr("cy", function (d) { return d.y; });
				
				 texts.attr("transform", function(d) {
        return "translate(" + d.x + "," + d.y + ")";
    });
        });
    });
}
</script>

	<script>
		d3Network("./net.json", 960, 800);
		</script>
</body>
</html>